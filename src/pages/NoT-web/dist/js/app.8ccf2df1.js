(function(){"use strict";var e={3326:function(e,t,s){var i=s(3751),n=s(6461),o=s(5220);const c=[{path:"/",name:"Home",component:()=>Promise.resolve().then(s.bind(s,6461)),meta:{title:"NoT——____————____"}}],l=(0,o.aE)({history:(0,o.Bt)(),routes:c});l.beforeEach(((e,t,s)=>{e.meta.title&&(document.title=e.meta.title),s()}));var r=l;const a=(0,i.Ef)(n["default"]);a.use(r),a.mount("#app")},6461:function(e,t,s){s.r(t),s.d(t,{default:function(){return Re}});var i=s(641),n=s(33);const o={class:"app-container"},c={class:"tabs"},l=["onClick"],r={class:"tab-content"};function a(e,t,s,a,d,u){return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.Lk)("div",c,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(d.tabs,(e=>((0,i.uX)(),(0,i.CE)("button",{key:e,class:(0,n.C4)(["tab-button",{active:d.currentTab===e}]),onClick:t=>d.currentTab=e},(0,n.v_)(e),11,l)))),128))]),(0,i.Lk)("div",r,[((0,i.uX)(),(0,i.Wv)(i.PR,null,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(d.currentTab)))],1024))])])}var d=s(3751);const u={key:0,class:"connected-device-container"},p={key:0},v=["onMousedown"],h={key:1,class:"local-ip-find"},f={class:"query-section"},k={key:0,class:"error-message"},g={class:"listener-section"},m={key:1,class:"device-list-section"},b={key:0,class:"device-list"},y={class:"device-info"},_={class:"-name"},C=["onClick"],S={key:1,class:"no-devices"},w={key:2,class:"error-section"};function L(e,t,s,o,c,l){const r=(0,i.g2)("localconnector"),a=(0,i.g2)("syncpanel"),L=(0,i.g2)("lk"),P=(0,i.g2)("ErrorSlot");return(0,i.uX)(),(0,i.CE)(i.FK,null,[this.isdevconnected&&this.isServiceOpen?((0,i.uX)(),(0,i.CE)("div",u,[t[8]||(t[8]=(0,i.Lk)("div",{class:"device_list_name"},[(0,i.Lk)("span",{style:{color:"lightgray"}},"已经连接设备")],-1)),(0,i.bF)(d.F,{name:"switch-fade",tag:"ul",class:"switch-list"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.connecteddev,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:e.id},[e.status_dev?((0,i.uX)(),(0,i.CE)("div",p,[(0,i.bF)(r,{device_name:e.id,device_ip:e.ip,device_port:e.port,index:s,onCloseDevice:l.removeDevice,onOpenDevice:l.openDeviceSync},null,8,["device_name","device_ip","device_port","index","onCloseDevice","onOpenDevice"])])):(0,i.Q3)("",!0),(0,i.Lk)("div",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.panels,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"sync-panel",style:(0,n.Tr)({left:e.position.x+"px",top:e.position.y+"px"}),onMousedown:t=>l.startDrag(t,e.id)},[t[7]||(t[7]=(0,i.Lk)("div",{class:"drag-handle"},null,-1)),(0,i.bF)(a,{device_name:e.deviceId,device_ip:e.deviceIp,device_port:e.devicePort,onCloseSync:()=>l.closeDeviceSync(e.deviceId)},null,8,["device_name","device_ip","device_port","onCloseSync"])],44,v)))),128))])])))),128))])),_:1})])):(0,i.Q3)("",!0),c.localIPs.length>0?((0,i.uX)(),(0,i.CE)("div",h,[(0,i.Lk)("div",null,[t[9]||(t[9]=(0,i.Lk)("span",{class:"ip-header"},"发现本地IP：",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.localIPs,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"ip-item"},(0,n.v_)(e),1)))),128))]),(0,i.Lk)("div",f,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.selectedIP=e),onInput:t[1]||(t[1]=(...e)=>l.validateIP&&l.validateIP(...e)),placeholder:"选择输入要开放的IP",class:"ip-input"},null,544),[[d.Jo,c.selectedIP]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.linkPort=e),placeholder:"端口号",onInput:t[3]||(t[3]=(...e)=>l.validatePort&&l.validatePort(...e)),class:"port-input"},null,544),[[d.Jo,c.linkPort]]),(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.serverOpen&&l.serverOpen(...e)),class:(0,n.C4)(["connect-button",this.isServiceOpen?"off":"on"])},(0,n.v_)(this.isServiceOpen?"服务开启成功,再次点击关闭":"服务开启"),3),this.inputError?((0,i.uX)(),(0,i.CE)("div",k,(0,n.v_)(this.error),1)):(0,i.Q3)("",!0)]),this.isServiceOpen?((0,i.uX)(),(0,i.Wv)(L,{key:0,onLksuccess:l.addDevicelist},null,8,["onLksuccess"])):(0,i.Q3)("",!0),(0,i.Lk)("div",g,[this.isServiceOpen?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[5]||(t[5]=(...e)=>l.toggleListening&&l.toggleListening(...e)),class:(0,n.C4)(["connect-button",this.isListening?"off":"on"])},(0,n.v_)(this.isListening?"停止监听局域网服务":"监听局域网服务"),3)):(0,i.Q3)("",!0),c.isListening?((0,i.uX)(),(0,i.CE)("div",m,[c.online_dev.length>0?((0,i.uX)(),(0,i.CE)("div",b,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.online_dev,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"device-item"},[(0,i.Lk)("div",{class:(0,n.C4)(["signal",e.device_name?"online":"offline"])},null,2),(0,i.Lk)("div",y,[(0,i.Lk)("span",_,(0,n.v_)(e.device_name),1)]),(0,i.Lk)("button",{onClick:t=>l.connectToDevice(e.device_name,e.device_ip,e.device_nodeport),class:"connect-button-small"}," 连接 ",8,C)])))),128))])):((0,i.uX)(),(0,i.CE)("div",S,"当前没有在线设备"))])):(0,i.Q3)("",!0)])])):c.localIPs.length<=0?((0,i.uX)(),(0,i.CE)("div",w,[(0,i.bF)(P,null,{default:(0,i.k6)((()=>t[10]||(t[10]=[(0,i.eW)("未发现 IP,请检查服务是否开启")]))),_:1}),(0,i.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>l.scanLocalIPs&&l.scanLocalIPs(...e)),class:"connect-button"},"重新获取")])):(0,i.Q3)("",!0)],64)}s(4114),s(8992),s(3215),s(4520),s(2577),s(3949);const P={class:"alert-box"};function I(e,t){return(0,i.uX)(),(0,i.CE)("div",P,[t[0]||(t[0]=(0,i.Lk)("strong",null,"This is an Error for",-1)),t[1]||(t[1]=(0,i.Lk)("br",null,null,-1)),(0,i.RG)(e.$slots,"default",{},void 0,!0)])}var E=s(6262);const D={},X=(0,E.A)(D,[["render",I],["__scopeId","data-v-7f686ab0"]]);var F=X,O=s(7805);const T={class:"device-frame"};function x(e,t,s,o,c,l){return(0,i.uX)(),(0,i.CE)("div",T,[(0,i.Lk)("button",{class:"button-devicename",onClick:t[0]||(t[0]=(...e)=>l.openDevice&&l.openDevice(...e))},(0,n.v_)(s.device_name),1),(0,i.Lk)("button",{class:"closebutton-devicename",onClick:t[1]||(t[1]=(...e)=>l.closeDevice&&l.closeDevice(...e))},"断开")])}var $={props:{device_name:String,index:Number,device_ip:String,device_port:String},methods:{async closeDevice(){try{const e=await fetch(`http://127.0.0.1:3345/tolocalws?device_ip=${this.device_ip}&device_port=${this.device_port}&connect_status=close`),t=await e.json();"closeok"==t.LinkStatus&&this.$emit("close-device",this.index)}catch(e){this.$emit("close-device",this.index)}},openDevice(){this.$emit("open-device",this.index)}}};const W=(0,E.A)($,[["render",x],["__scopeId","data-v-6fc5fec0"]]);var N=W;const A={class:"link-frame"},z={style:{"flex-direction":"column"}};function J(e,t,s,o,c,l){return(0,i.uX)(),(0,i.CE)("div",A,[(0,i.Lk)("div",z,[t[4]||(t[4]=(0,i.Lk)("div",null,[(0,i.Lk)("span",{style:{color:"grey"}},"若已知局域网IP直接连接")],-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.linkIp=e),placeholder:"输入IP",class:(0,n.C4)([{"input-error":c.inputError},"ip-input"])},null,2),[[d.Jo,c.linkIp]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.linkPort=e),onInput:t[2]||(t[2]=(...e)=>l.validatePort&&l.validatePort(...e)),placeholder:"端口号",class:(0,n.C4)([{"input-error":c.inputError},"port-input"])},null,34),[[d.Jo,c.linkPort]]),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.connectTOlocalDevice&&l.connectTOlocalDevice(...e)),class:(0,n.C4)(["connect-button",this.isServiceOpen?"off":"on"])}," 连接 ",2)])])}var M={data(){return{linkPort:33451,linkIp:"",inputError:!1}},methods:{validatePort(){const e=Number(this.linkPort);this.inputError=!(e>=0&&e<=65535)},async connectTOlocalDevice(){const e=await fetch(`http://127.0.0.1:3345/tolocalws?device_ip=${this.linkIp}&device_port=${this.linkPort}&connect_status=open`),t=await e.json();"connectok"==t.LinkStatus&&(this.$emit("lksuccess",this.linkIp,this.linkIp,this.linkPort),this.linkIp="",this.inkPort=33451)}}};const j=(0,E.A)(M,[["render",J],["__scopeId","data-v-51c23e6e"]]);var K=j;const Q={class:"sync-container"},U={class:"sync-header"},q={class:"device-info"},B={class:"device-details"},R={class:"device-name"},V={class:"tab-buttons"},Y=["onClick"],G={class:"tab-icon"},H={class:"sync-content"};function Z(e,t,s,o,c,l){return(0,i.uX)(),(0,i.CE)("div",Q,[(0,i.Lk)("div",U,[(0,i.Lk)("div",q,[t[2]||(t[2]=(0,i.Lk)("span",{class:"device-icon"},"🔗",-1)),(0,i.Lk)("div",B,[t[1]||(t[1]=(0,i.Lk)("span",{class:"device-label"},"连接设备",-1)),(0,i.Lk)("h3",R,(0,n.v_)(s.device_name),1)])]),(0,i.Lk)("div",V,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.tabs,(e=>((0,i.uX)(),(0,i.CE)("button",{key:e.id,onClick:t=>c.activeTab=e.id,class:(0,n.C4)(["tab-btn",{active:c.activeTab===e.id}])},[(0,i.Lk)("span",G,(0,n.v_)(e.icon),1),(0,i.eW)(" "+(0,n.v_)(e.name),1)],10,Y)))),128))]),(0,i.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close-sync",s.index)),class:"close-btn"},t[3]||(t[3]=[(0,i.Lk)("span",{class:"close-icon"},"×",-1)]))]),(0,i.Lk)("div",H,[(0,i.bF)(d.eB,{name:"fade",mode:"out-in"},{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.Wv)(i.PR,null,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(l.currentPanel),{device_name:s.device_name,device_ip:s.device_ip,device_port:s.device_port},null,8,["device_name","device_ip","device_port"]))],1024))])),_:1})])])}const ee={class:"clipboard-panel"},te={class:"clipboard-area"},se={class:"sync-status"};function ie(e,t,s,o,c,l){return(0,i.uX)(),(0,i.CE)("div",ee,[(0,i.Lk)("div",te,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.clipboardContent=e),onInput:t[1]||(t[1]=(...e)=>l.handleInput&&l.handleInput(...e)),placeholder:"在此输入或粘贴内容..."},null,544),[[d.Jo,c.clipboardContent]])]),(0,i.Lk)("div",se,(0,n.v_)(c.syncStatus),1)])}var ne={props:{device_name:String,device_ip:String,device_port:String},data(){return{clipboardContent:"",syncStatus:"等待连接...",isConnected:!1,ws:null,clipboardsocketefws:null}},methods:{clearContent(){this.clipboardContent=""},async copyToClipboard(){try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(this.clipboardContent);else{const t=document.createElement("textarea");t.value=this.clipboardContent,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),t.remove()}catch(e){throw console.error("Fallback copy failed:",e),t.remove(),new Error("Copy operation failed")}}this.syncStatus="已复制到剪切板",setTimeout((()=>{this.syncStatus=this.isConnected?"已连接":"等待连接"}),2e3)}catch(e){console.error("Copy failed:",e),this.syncStatus="复制失败",setTimeout((()=>{this.syncStatus=this.isConnected?"已连接":"等待连接"}),2e3)}},handleInput(){this.isConnected&&this.ws&&this.ws.send(JSON.stringify({reqlinkname:this.device_name,reqlinkip:this.device_ip,reqlinkport:this.device_port,type:"clipboard",content:this.clipboardContent}))},initWebSocket(){const e=`ws://${this.device_ip}:${this.device_port}`;this.ws=new WebSocket(e),this.ws.onopen=()=>{this.isConnected=!0,this.syncStatus="已连接"},this.ws.onclose=()=>{this.isConnected=!1,this.syncStatus="连接已断开",setTimeout((()=>this.initWebSocket()),3e3)},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.syncStatus="连接错误"}},clipboardsetupEFws(){this.clipboardsocketefws=new WebSocket("ws://127.0.0.1:33456?userId=clipboardws"),this.clipboardsocketefws.onopen=()=>{console.log("cpb Connected to backend WebSocket")},this.clipboardsocketefws.onmessage=e=>{const t=e.data.toString(),s=JSON.parse(t),i=JSON.parse(s.fromlocaldev),n=i.type,o=i.content;console.log(o),"clipboard"===n&&(this.clipboardContent=o,this.copyToClipboard())}}},mounted(){this.initWebSocket(),this.clipboardsetupEFws()},beforeUnmount(){console.log("beforeUnmount"),this.ws&&this.ws.close(),this.clipboardsocketefws&&this.clipboardsocketefws.close()}};const oe=(0,E.A)(ne,[["render",ie],["__scopeId","data-v-3e023d66"]]);var ce=oe;const le={class:"file-transfer-panel"},re={class:"transfer-list"},ae={key:0},de={class:"file-info"},ue={class:"file-name"},pe={class:"file-size"},ve=["onClick"],he={class:"status-container"},fe={key:0,class:"status success"},ke={key:1,class:"status error"},ge={key:2,class:"status error"},me={key:1,class:"empty-item"},be={class:"transfer-list"},ye={key:0},_e={class:"file-info"},Ce={class:"file-name"},Se={class:"file-size"},we=["onClick"],Le={class:"status-container"},Pe={key:0,class:"status success"},Ie={key:1,class:"status error"},Ee={key:2,class:"status error"},De={key:1,class:"empty-item"},Xe={class:"upload-content"};function Fe(e,t,s,o,c,l){return(0,i.uX)(),(0,i.CE)("div",le,[(0,i.Lk)("div",re,[c.receivefiles.length?((0,i.uX)(),(0,i.CE)("div",ae,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.receivefiles,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"transfer-item"},[(0,i.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:e.fileProgress+"%"})},null,4),(0,i.Lk)("div",de,[(0,i.Lk)("div",ue,(0,n.v_)(e.fileName),1),(0,i.Lk)("div",pe,(0,n.v_)(l.formatFileSize(e.fileSize)),1)]),(0,i.Lk)("button",{onClick:e=>l.deleteFile(t),class:"remove-btn",title:"删除文件"}," ✖ ",8,ve),(0,i.Lk)("div",he,["success"===e.filestatus?((0,i.uX)(),(0,i.CE)("span",fe,"接收成功")):"canceled"===e.filestatus?((0,i.uX)(),(0,i.CE)("span",ke,"传输已经取消")):"pending"===e.filestatus?((0,i.uX)(),(0,i.CE)("span",ge,"传输中")):(0,i.Q3)("",!0)])])))),128))])):((0,i.uX)(),(0,i.CE)("div",me," 暂未接收到文件 "))]),(0,i.Lk)("div",be,[c.sendfiles.length?((0,i.uX)(),(0,i.CE)("div",ye,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.sendfiles,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"transfer-item"},[(0,i.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:e.progress+"%"})},null,4),(0,i.Lk)("div",_e,[(0,i.Lk)("div",Ce,(0,n.v_)(e.file.name),1),(0,i.Lk)("div",Se,(0,n.v_)(l.formatFileSize(e.file.size)),1)]),(0,i.Lk)("button",{onClick:e=>l.removeFile(t),class:"remove-btn",title:"删除文件"}," ✖ ",8,we),(0,i.Lk)("div",Le,["success"===e.status?((0,i.uX)(),(0,i.CE)("span",Pe,"发送成功")):"canceled"===e.status?((0,i.uX)(),(0,i.CE)("span",Ie,"传输已经取消")):"error"===e.status?((0,i.uX)(),(0,i.CE)("span",Ee,"发送失败")):(0,i.Q3)("",!0)])])))),128))])):((0,i.uX)(),(0,i.CE)("div",De,"暂无待发送文件"))]),c.sendfiles.length?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>l.sendMultiMultipleFiles&&l.sendMultiMultipleFiles(...e)),class:"send-btn"}," 发送文件 ("+(0,n.v_)(c.sendfiles.length)+") ",1)):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:(0,n.C4)(["upload-area",{dragging:c.isDragging}]),onDrop:t[3]||(t[3]=(0,d.D$)(((...e)=>l.handleDrop&&l.handleDrop(...e)),["prevent"])),onDragover:t[4]||(t[4]=(0,d.D$)(((...e)=>l.handleDragOver&&l.handleDragOver(...e)),["prevent"])),onDragleave:t[5]||(t[5]=(0,d.D$)(((...e)=>l.handleDragLeave&&l.handleDragLeave(...e)),["prevent"]))},[(0,i.Lk)("input",{type:"file",ref:"fileInput",onChange:t[1]||(t[1]=(...e)=>l.handleFileSelect&&l.handleFileSelect(...e)),multiple:"",style:{display:"none"}},null,544),(0,i.Lk)("div",Xe,[t[6]||(t[6]=(0,i.Lk)("i",{class:"upload-icon"},"📁",-1)),t[7]||(t[7]=(0,i.Lk)("p",null,"拖拽文件到此处或",-1)),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.fileInputClick&&l.fileInputClick(...e)),class:"upload-btn"}," 选择文件 ")])],34)])}s(7550);var Oe={name:"FileTransferPanel",props:{device_name:String,device_ip:String,device_port:String},data(){return{sendfiles:[],receivefiles:[],isDragging:!1,isConnected:!1,ws:null,filesocketefws:null}},mounted(){this.initWebSocket(),this.transfilesetupEFws()},methods:{transfilesetupEFws(){this.filesocketefws=new WebSocket("ws://127.0.0.1:33456?userId=transfilews"),this.filesocketefws.onopen=()=>{console.log("ft Connected to backend WebSocket")},this.filesocketefws.onmessage=e=>{const t=e.data.toString(),s=JSON.parse(t),i=JSON.parse(s.fromlocaldev),n=i.type,o=i.transfilename,c=i.transfilesize,l=i.transfileprogress,r=i.transfilestatus,a=i.transfilefromwhere;if(console.log(i),"transfile"===n)if("s"==a){if(this.receivefiles.some((e=>e.fileName===o))||this.receivefiles.push({fileName:o,fileSize:c,fileProgress:0,filestatus:"pending"}),0!=l){const e=this.receivefiles.find((e=>e.fileName===o));e.fileProgress=l,100==l&&(e.filestatus="success"),"canceled"==r&&(e.filestatus="canceled")}}else if("r"==a&&0!=l)try{const e=this.sendfiles.find((e=>e.file.name===o));"canceled"==r&&(e.status="canceled")}catch(d){console.log(d)}}},initWebSocket(){const e=`ws://${this.device_ip}:${this.device_port}`;this.ws=new WebSocket(e),this.ws.onopen=()=>{this.isConnected=!0,this.syncStatus="已连接"},this.ws.onclose=()=>{this.isConnected=!1,this.syncStatus="连接已断开",setTimeout((()=>this.initWebSocket()),3e3)},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.syncStatus="连接错误"}},handleFileSelect(e){const t=Array.from(e.target.files);this.addFiles(t),this.$refs.fileInput.value=""},handleDrop(e){const t=Array.from(e.dataTransfer.files);this.addFiles(t),this.isDragging=!1},handleDragOver(){this.isDragging=!0},handleDragLeave(){this.isDragging=!1},addFiles(e){e.forEach((e=>{this.sendfiles.some((t=>t.name===e.name))||this.sendfiles.push({file:e,progress:0,status:"pending"})}))},removeFile(e){this.sendfiles[e].progress=0,this.sendfiles[e].status="canceled",this.sendfiles.splice(e,1)},deleteFile(e){this.receivefiles.fileProgress=0,this.receivefiles[e].filestatus="canceled";const t=this.receivefiles[e].fileName,s=this.receivefiles[e].fileSize,i=this.receivefiles[e].filestatus,n={fileName:t,fileSize:s,status:i,from:"r"};this.ws.send(JSON.stringify({type:"transfile",metadata:n})),this.receivefiles.splice(e,1)},formatFileSize(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1024/1024).toFixed(1)} MB`},splitFile(e,t){const s=[];let i=0;while(i<e.size)s.push(e.slice(i,i+t)),i+=t;return s},async sendFileChunks(e,t){const s=8388608,i=this.splitFile(e.file,s),n=i.length;for(let o=0;o<n;o++){if("canceled"==e.status){const s={fileName:e.file.name,fileType:e.file.type,fileSize:e.file.size,filelastModifiedDate:e.file.lastModified,chunkNum:n,currentChunk:o,status:"canceled",from:"s"};return console.log(`文件传输已取消: ${e.file.name}`),void t.send(JSON.stringify({type:"transfile",metadata:s}))}const s=i[o],c={fileName:e.file.name,fileType:e.file.type,fileSize:e.file.size,filelastModifiedDate:e.file.lastModified,chunkNum:n,currentChunk:o,status:"transing",from:"s"},l=await new Promise(((e,t)=>{const i=new FileReader;i.onload=()=>e(i.result.split(",")[1]),i.onerror=()=>t(new Error("Blob 转换失败")),i.readAsDataURL(s)}));t.send(JSON.stringify({type:"transfile",metadata:c,chunks:l})),await new Promise((s=>{t.onmessage=t=>{const i=JSON.parse(t.data);"ack"===i.type&&i.chunk==o+1&&(e.progress=Math.round((o+1)/n*100),s())}}))}e.status="success"},async sendMultiMultipleFiles(){console.log("发送以下文件:",this.sendfiles);for(const t of this.sendfiles)try{await this.sendFileChunks(t,this.ws)}catch(e){t.status="error",console.error("文件传输失败:",e)}},fileInputClick(){this.$refs.fileInput.click()}}};const Te=(0,E.A)(Oe,[["render",Fe],["__scopeId","data-v-0fb57707"]]);var xe=Te,$e={components:{ClipboardPanel:ce,FileTransferPanel:xe},props:{index:Number,device_name:String,device_ip:String,device_port:String},data(){return{activeTab:"clipboard",tabs:[{id:"clipboard",name:"剪切板同步",icon:"📋"},{id:"file",name:"文件传输",icon:"📁"}]}},computed:{currentPanel(){return"clipboard"===this.activeTab?ce:xe}}};const We=(0,E.A)($e,[["render",Z],["__scopeId","data-v-475b9752"]]);var Ne=We,Ae={components:{ErrorSlot:F,localconnector:N,lk:K,syncpanel:Ne},data(){return{localIPs:[],error:"",selectedIP:"",isListening:!1,inputError:!1,isServiceOpen:!1,socket:null,socketefws:null,online_dev:"",linkPort:33451,isdevconnected:!1,connecteddev:[],panelPosition:{x:0,y:0},isDragging:!1,dragOffset:{x:0,y:0},panels:[]}},async mounted(){await this.scanLocalIPs()},methods:{validateIP(){const e=/^(\d{1,3}\.){3}\d{1,3}$/,t=/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::$/,s=/[\u4e00-\u9fa5]/;return this.selectedIP.trim()?s.test(this.selectedIP)?(this.error="IP地址不能包含汉字",void(this.inputError=!0)):e.test(this.selectedIP)||t.test(this.selectedIP)?(this.error="",void(this.inputError=!1)):(this.error="请输入有效的IPv4或IPv6地址",void(this.inputError=!0)):(this.error="",void(this.inputError=!1))},validatePort(){if(!this.linkPort||""===this.linkPort.trim())return this.error="",void(this.inputError=!1);if(!/^\d+$/.test(this.linkPort))return this.error="端口号只能包含数字",this.inputError=!0,void(this.linkPort=this.linkPort.replace(/\D/g,""));const e=Number(this.linkPort);if(e<0||e>65535)return this.error="端口号必须在0-65535之间",this.inputError=!0,void(this.linkPort=this.linkPort.slice(0,-1));this.error="",this.inputError=!1},async scanLocalIPs(){this.localIPs=[],this.error="";try{const e=await fetch("http://127.0.0.1:5001/api/getlocalip"),t=await e.json();t.localIPs&&t.localIPs.length>0?this.localIPs=t.localIPs:this.error="未发现 IP 地址"}catch(e){console.error("Error scanning local IPs:",e),this.error="获取局域网 IP 失败，请检查网络连接或重试。"}},async toggleListening(){this.listen_action=this.isListening?"0":"1";try{const e=await fetch(`http://127.0.0.1:5001/api/listenserver?ls=${this.listen_action}`),t=await e.json();"1"!=t.status||this.isListening?"2"==t.status&&this.isListening&&(this.isListening=!1,this.closeWebSocket()):(this.isListening=!0,this.online_dev="",this.setupWebSocket())}catch(e){this.buttonText="监听局域网服务",this.error="查找错误"}},async serverOpen(){if(!this.inputError&&!this.err){this.action=this.isServiceOpen?"0":"1";try{const e=await fetch(`http://127.0.0.1:5001/api/serv?ip=${this.selectedIP}&port=${this.linkPort}&isopen=${this.action}`),t=await e.json();1===t.status_id?(this.isServiceOpen=!0,this.setupEFws()):2===t.status_id?this.isServiceOpen=!1:this.error="服务开启失败"}catch(e){console.log("service open failed..."+e)}}},setupEFws(){this.socketefws=new WebSocket("ws://127.0.0.1:33456?userId=frontws"),this.socketefws.onopen=()=>{console.log("Connected to backend WebSocket")},this.socketefws.onmessage=e=>{const t=e.data.toString(),s=JSON.parse(t),i=JSON.parse(s.fromlocaldev);console.log(i),"accept"==i.status?this.addDevicelist(i.localreqlinknames,i.localreqlinkip,i.localreqlinkport):"reject"==i.status&&(this.connecteddev.forEach((e=>{e.id===i.localreqlinknames&&(e.status_dev=!1,e.opensyncpanel=!1)})),this.connecteddev.every((e=>!e.status_dev))&&(this.isdevconnected=!1))},this.socketefws.onclose=()=>{console.log("Disconnected from WebSocket")},console.log(this.connecteddev)},setupWebSocket(){this.socket=(0,O.Ay)("http://localhost:5001"),this.socket.on("connect",(()=>{console.log("Connected to WebSocket")})),this.socket.on("device_list",(e=>{e&&e.online_device&&(console.log(e.online_device),this.online_dev=e.online_device)})),this.socket.on("error",(e=>{console.error("WebSocket error:",e)})),this.socket.on("disconnect",(()=>{console.log("Disconnected from WebSocket")}))},closeWebSocket(){this.socket&&(this.socket.disconnect(),console.log("WebSocket disconnected"))},beforeUnmount(){this.closeWebSocket()},async connectToDevice(e,t,s){const i=await fetch(`http://127.0.0.1:3345/tolocalws?device_ip=${t}&device_port=${s}&connect_status=open`),n=await i.json();"connectok"==n.LinkStatus&&this.addDevicelist(e,t,s)},addDevicelist(e,t,s){if(!this.localIPs.find((e=>e===t))){if(this.isdevconnected=!0,0==this.connecteddev.length&&this.isdevconnected)this.connecteddev.push({id:e,ip:t,port:s,status_dev:!0,opensyncpanel:!1});else{const i=this.connecteddev.find((e=>e.ip===t));i?i.status_dev=!0:this.connecteddev.push({id:e,ip:t,port:s,status_dev:!0,opensyncpanel:!1})}console.log(this.connecteddev)}},removeDevice(e){if(this.connecteddev[e]){this.connecteddev[e].status_dev=!1,this.connecteddev[e].opensyncpanel=!1,this.connecteddev.every((e=>!e.status_dev))&&(this.isdevconnected=!1);const t=this.connecteddev[e].id;this.closeDeviceSync(t)}},openDeviceSync(e){const t={id:Date.now(),deviceId:this.connecteddev[e].id,deviceIp:this.connecteddev[e].ip,devicePort:this.connecteddev[e].port,position:{x:100+30*this.panels.length,y:100+30*this.panels.length}};this.panels.push(t),this.connecteddev[e].opensyncpanel=!0,console.log(this.panels)},closeDeviceSync(e){this.panels=this.panels.filter((t=>t.deviceId!==e)),console.log(this.panels);const t=this.connecteddev.find((t=>e===t.id));t&&(t.opensyncpanel=!1)},startDrag(e,t){if(!e.target.closest(".drag-handle"))return;const s=this.panels.find((e=>e.id===t));s&&(this.draggingPanelId=t,this.dragOffset={x:e.clientX-s.position.x,y:e.clientY-s.position.y},document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.stopDrag))},handleDrag(e){if(!this.draggingPanelId)return;const t=this.panels.find((e=>e.id===this.draggingPanelId));t&&(t.position={x:e.clientX-this.dragOffset.x,y:e.clientY-this.dragOffset.y})},stopDrag(){this.draggingPanelId=null,document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)}},beforeUnmount(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)}};const ze=(0,E.A)(Ae,[["render",L],["__scopeId","data-v-0e13ff1c"]]);var Je=ze;const Me={class:"tab"};function je(e,t){return(0,i.uX)(),(0,i.CE)("div",Me,"暂未开发")}const Ke={},Qe=(0,E.A)(Ke,[["render",je]]);var Ue=Qe,qe={components:{LAN:Je,IP:Ue,localconnector:N},data(){return{currentTab:"LAN",tabs:["LAN","IP"]}}};const Be=(0,E.A)(qe,[["render",a],["__scopeId","data-v-2acc47b6"]]);var Re=Be}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,o){if(!i){var c=1/0;for(d=0;d<e.length;d++){i=e[d][0],n=e[d][1],o=e[d][2];for(var l=!0,r=0;r<i.length;r++)(!1&o||c>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[r])}))?i.splice(r--,1):(l=!1,o<c&&(c=o));if(l){e.splice(d--,1);var a=n();void 0!==a&&(t=a)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,n,o]}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,o,c=i[0],l=i[1],r=i[2],a=0;if(c.some((function(t){return 0!==e[t]}))){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(r)var d=r(s)}for(t&&t(i);a<c.length;a++)o=c[a],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},i=self["webpackChunkNoT_web"]=self["webpackChunkNoT_web"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(3326)}));i=s.O(i)})();
//# sourceMappingURL=app.8ccf2df1.js.map